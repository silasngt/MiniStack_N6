extends ../../layouts/default.pug

block main
    .post-management-content
        //- Header Section
        .header-section
            h1.page-title Danh sách bài viết
            a.btn-add-post(href="/admin/posts/create") Thêm bài viết mới
        //- Success messages
        if success === 'created'
            .alert.alert-success ✅ Bài viết đã được tạo thành công!
        if success === 'updated'
            .alert.alert-success ✅ Bài viết đã được cập nhật thành công!
        if success === 'deleted'
            .alert.alert-success ✅ Bài viết đã được xóa thành công!

        //- Post Table
        .table-container
            table.post-table
                thead
                    tr
                        th ID
                        th Tiêu đề
                        th Nội dung
                        th Tác giả
                        th Danh mục
                        th Ngày tạo
                        th Thao tác

                tbody
                    if posts && posts.length > 0
                        each post in posts
                            tr.post-row
                                td.post-id= post.PostID
                                td.post-title.truncate(title=post.Title)= post.Title
                                td.post-content.truncate(title=post.Content)= post.Content
                                td.post-author= post.authorName
                                td.post-category= post.categoryNames || 'Chưa phân loại'
                                td.post-date= post.formattedDate
                                td.post-actions
                                    .btn-group(role="group")
                                        button.btn.btn-outline-secondary.btn-sm(title="Trạng thái hoạt động" onclick=`viewPost(${post.PostID})`)
                                            i.fas.fa-eye
                                        button.btn.btn-outline-primary.btn-sm(title="Chỉnh sửa" onclick=`editPost(${post.PostID})`)
                                            i.fas.fa-pencil-alt
                                        button.btn.btn-outline-danger.btn-sm(title="Xóa" onclick=`deletePost(${post.PostID})`)
                                            i.fas.fa-trash
                    else
                        tr
                            td(colspan="9" style="text-align: center; padding: 40px; color: #999;")
                                i.fas.fa-inbox(style="font-size: 3rem; margin-bottom: 15px; display: block;")
                                div Chưa có bài viết nào
                                a.btn-add-post(href="/admin/posts/create" style="margin-top: 15px; display: inline-block;") Thêm bài viết đầu tiên

        //- Pagination (simple version)
        if posts && posts.length > 5
            .pagination-container
                .pagination
                    button.btn-page.btn-prev(disabled)
                        i.fas.fa-chevron-left
                        span Prev

                    button.btn-page.active 1

                    button.btn-page.btn-next
                        span Next
                        i.fas.fa-chevron-right

    //- JavaScript functions
    script.
        function viewPost(postId) {
            // TODO: Implement view post detail
            console.log('View post:', postId);
            alert('Xem chi tiết bài viết #' + postId);
        }

        function editPost(postId) {
            window.location.href = `/admin/posts/edit/${postId}`;
        }

        function deletePost(postId) {
            if (confirm('Bạn có chắc chắn muốn xóa bài viết này?')) {
                // TODO: Implement delete post
                console.log('Delete post:', postId);
                // Call API to delete post
                fetch(`/admin/posts/delete/${postId}`, {
                    method: 'DELETE'
                }).then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('Có lỗi xảy ra khi xóa bài viết!');
                    }
                });
            }
        }

        // Success message auto hide
        document.addEventListener('DOMContentLoaded', function() {
            const successAlert = document.querySelector('.alert-success');
            if (successAlert) {
                setTimeout(() => {
                    successAlert.style.opacity = '0';
                    setTimeout(() => {
                        successAlert.remove();
                    }, 300);
                }, 3000);
            }
        });